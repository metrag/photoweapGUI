<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ë–û–ô</title>
  <link rel="stylesheet" href="/static/css/fight.css">
</head>
<body>

<div class="container">

  <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
  <div class="column left-column">
    <h2 id="team-name-1">{{ team1 }}</h2>

    <ul class="members-list">
      {% if members1 %}
        {% for member in members1 %}
          <li>
            <span>{{ loop.index }}.</span>
            <span>{{ member.rank or '–≤/–∑' }} {{ member.name or '–§–ò–û' }}</span>
            <button class="status-button active" data-team="1" data-number="{{ loop.index }}" data-status="alive"></button>
          </li>
        {% endfor %}
      {% else %}
        <li><em>–ù–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</em></li>
      {% endif %}
    </ul>

    <div class="stats">
      <p>–í —Å—Ç—Ä–æ—é: <span class="in-battle-count">{{ members1 | length }}</span></p>
      <p>–£–±–∏—Ç—ã: <span class="killed-count">0</span></p>
    </div>
  </div>

  <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
  <div class="column center-column">
    <div class="battle-field">
      <img id="camera-feed" src="/static/img/download.png" alt="–§–æ—Ç–æ —Å –∫–∞–º–µ—Ä—ã" style="width:100%; border-radius:10px;">
    </div>

    <div class="info-panel">
      <p><strong>–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:</strong></p>
      <div class="radio-group" id="team-radio-group">
        <label>
          <input type="radio" name="team-select" value="1" checked>
          {{ team1 }}
        </label>
        <label>
          <input type="radio" name="team-select" value="2">
          {{ team2 }}
        </label>
      </div>

      <p><strong>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–º–µ—Ä:</strong></p>
      <div class="radio-group" id="number-radio-group">
        <!-- –ù–æ–º–µ—Ä–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã JS -->
      </div>
    </div>

    <div class="button-group">
      <button class="status-btn dead" id="btn-dead">–£–±–∏—Ç</button>
      <button class="status-btn alive" id="btn-alive">–í —Å—Ç—Ä–æ—é</button>
    </div>
  </div>

  <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
  <div class="column right-column">
    <h2 id="team-name-2">{{ team2 }}</h2>

    <ul class="members-list">
      {% if members2 %}
        {% for member in members2 %}
          <li>
            <span>{{ loop.index }}.</span>
            <span>{{ member.rank or '–≤/–∑' }} {{ member.name or '–§–ò–û' }}</span>
            <button class="status-button active" data-team="2" data-number="{{ loop.index }}" data-status="alive"></button>
          </li>
        {% endfor %}
      {% else %}
        <li><em>–ù–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</em></li>
      {% endif %}
    </ul>

    <div class="stats">
      <p>–í —Å—Ç—Ä–æ—é: <span class="in-battle-count">{{ members2 | length }}</span></p>
      <p>–£–±–∏—Ç—ã: <span class="killed-count">0</span></p>
    </div>
  </div>

</div>

<script>
  const members1 = {{ members1|tojson }};
  const members2 = {{ members2|tojson }};
</script>

<!-- –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –≤ JS -->
<script>
  const members1 = [
    {% if members1 %}
      {% for member in members1 %}
        { "rank": "{{ member.rank or '–≤/–∑' }}", "name": "{{ member.name or '–§–ò–û' }}" },
      {% endfor %}
    {% endif %}
  ];

  const members2 = [
    {% if members2 %}
      {% for member in members2 %}
        { "rank": "{{ member.rank or '–≤/–∑' }}", "name": "{{ member.name or '–§–ò–û' }}" },
      {% endfor %}
    {% endif %}
  ];
</script>

<script>
  // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ
  const eventSource = new EventSource("/photo-updated");

  eventSource.onmessage = function(event) {
    console.log("üì∑ –ù–æ–≤–æ–µ —Ñ–æ—Ç–æ –≥–æ—Ç–æ–≤–æ!");
    fetchNextPhoto(); // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
  };

  eventSource.onerror = function(err) {
    console.error("‚ö†Ô∏è –û—à–∏–±–∫–∞ SSE:", err);
    setTimeout(() => location.reload(), 10000); // –ß–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
  };
</script>

<script src="/static/js/fight.js"></script>


<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ JS -->
<script src="/static/js/fight.js"></script>

</body>
</html>